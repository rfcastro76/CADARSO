# Setup de Proyecto con GitHub Copilot
## Documentaci√≥n Previa para Desarrollo Asistido

### üéØ Objetivo
Configurar un proyecto desde cero con las convenciones y documentaci√≥n necesaria para que GitHub Copilot y el equipo trabajen de manera consistente y eficiente.

---

## 1. ¬øPor qu√© documentar "Instructions"?

Las **Instructions** son el contexto fijo que GitHub Copilot utiliza para:
- ‚úÖ Alinearse con las reglas y estilo del proyecto
- ‚úÖ Generar c√≥digo consistente con las convenciones del equipo
- ‚úÖ Aplicar las mejores pr√°cticas autom√°ticamente
- ‚úÖ Facilitar la colaboraci√≥n y reproducibilidad

**Beneficio clave**: Copilot genera c√≥digo que ya cumple con tus est√°ndares desde el primer intento.

---

## 2. Estructura de Archivos Recomendada

### ¬øPor qu√© usar `.github/`?

GitHub reconoce autom√°ticamente esta carpeta y activa funcionalidades especiales:

```
.github/
‚îú‚îÄ‚îÄ copilot-instructions.md    # Instrucciones para Copilot
‚îú‚îÄ‚îÄ PULL_REQUEST_TEMPLATE.md   # Template autom√°tico para PRs
‚îú‚îÄ‚îÄ ISSUE_TEMPLATE.md          # Template para issues
‚îú‚îÄ‚îÄ CONTRIBUTING.md            # Gu√≠a de contribuci√≥n
‚îú‚îÄ‚îÄ prompts/                   # Prompts organizados del proyecto
‚îî‚îÄ‚îÄ workflows/                 # GitHub Actions (CI/CD)
```

**Beneficios**:
- ü§ñ **Para Copilot**: Lee autom√°ticamente las instrucciones
- üë• **Para el equipo**: Proceso estandarizado y autom√°tico
- üèóÔ∏è **Para el proyecto**: Mantiene la ra√≠z limpia y organizada

---

## 3. Template de Instructions (Listo para Copiar)

Crea `.github/copilot-instructions.md` con este contenido:

```markdown
# Project Instructions for GitHub Copilot

## Project Overview
**Project**: [Nombre del proyecto]
**Purpose**: [Descripci√≥n en una l√≠nea del prop√≥sito]
**Tech Stack**: [Python 3.11, FastAPI, PostgreSQL, etc.]

## Coding Standards

### Style & Formatting
- **Formatter**: [black, prettier, etc.]
- **Linter**: [flake8, eslint, etc.]
- **Line length**: 88 characters (Python) / 80 characters (others)

### Code Quality
- Use type hints in Python
- Prefer explicit over implicit
- Include docstrings for all public functions
- Use meaningful variable names

## Commit Conventions

**Format**: `<type>(<scope>): <description>`

### Types
- `feat`: New feature
- `fix`: Bug fix  
- `refactor`: Code restructuring
- `docs`: Documentation changes
- `test`: Adding/updating tests
- `perf`: Performance improvements
- `ci`: CI/CD changes
- `chore`: Maintenance tasks

### Examples
```
feat(auth): add JWT token validation
fix(database): resolve connection timeout issue
refactor(utils): extract common validation logic
docs(api): update endpoint documentation
test(user): add unit tests for user creation
```

### Commit Structure
1. **Title** (max 72 chars): Concise change description
2. **Body** (optional): Explain WHAT and WHY, not HOW
3. **Footer** (optional): Issue references, breaking changes

### Anti-patterns
‚ùå `fix bug` - Too vague
‚ùå `update files` - Not specific
‚ùå `wip` - Work in progress shouldn't be in main

## Testing

### Framework
- **Python**: pytest
- **JavaScript**: jest
- **Commands**: `pytest` or `npm test`
- **Coverage**: Target >80%

### Best Practices
- Use mocks for external APIs
- Separate unit and integration tests
- Include performance tests for critical paths
- Mock external dependencies

### Test Structure
```python
# test_example.py
def test_function_should_return_expected_result():
    # Given
    input_data = "test"
    
    # When
    result = function_under_test(input_data)
    
    # Then
    assert result == "expected"
```

## Error Handling

### API Errors
- Implement retry logic with exponential backoff
- Maximum 3 retry attempts
- Handle rate limits gracefully
- Log all retry attempts

### User-Facing Errors
- Messages in Spanish for end users
- Include actionable suggestions
- Log technical details separately

### Example
```python
try:
    result = api_call()
except RateLimitError:
    time.sleep(exponential_backoff)
    retry_with_jitter()
except ValidationError as e:
    logger.error(f"Validation failed: {e}")
    return {"error": "Datos inv√°lidos. Verifica el formato."}
```

## Logging

### Format
```python
# JSON structured logs
{
    "timestamp": "2024-01-01T12:00:00Z",
    "level": "INFO",
    "component": "auth_service",
    "message": "User login successful",
    "user_id": "12345"
}
```

### Levels
- **DEBUG**: Detailed diagnostic info
- **INFO**: General operational messages
- **WARN**: Potentially harmful situations
- **ERROR**: Error events that might allow the app to continue

### Best Practices
- No sensitive data in logs
- Include request IDs for tracing
- Use structured logging (JSON)
- Log entry and exit of critical functions

## Security

### Secrets Management
- ‚úÖ Use environment variables
- ‚úÖ Use secret managers (Azure KeyVault, AWS Secrets)
- ‚ùå Never commit `.env` files
- ‚ùå No hardcoded passwords or API keys

### Code Security
- Validate all inputs
- Use parameterized queries
- Implement rate limiting
- Regular dependency updates

## CI/CD

### Pipeline Location
`.github/workflows/main.yml`

### Standard Commands
```yaml
- install dependencies
- run linter
- run tests
- check coverage
- build application
- run security scans
```

### Quality Gates
- All tests must pass
- Coverage > 80%
- No linting errors
- Security scan passes

## Database

### Migrations
- Use version-controlled migrations
- Include rollback scripts
- Test migrations on staging first

### Queries
- Use EXPLAIN for complex queries
- Prefer JOINs over subqueries when possible
- Index frequently queried columns
- Always use parameterized queries

---

**Last Updated**: [Date]
**Contact**: [Team contact for questions]
```

---

## 4. Convenciones de Commits Detalladas

### Formato Est√°ndar
```
<type>(<scope>): <description>

[optional body]

[optional footer]
```

### Ejemplos Espec√≠ficos por Contexto

#### Para Modelos y AI
```
model(gemini): upgrade to gemini-2.0-flash-exp
prompt(mapping): improve precision rules for financial data  
schema(qa0): add new variables for Mexican market
```

#### Para Features y Fixes
```
feat(auto_mapeo): implement intelligent row selection strategy

Replace simple df.iloc[:20] with density-based selection
Improves context quality for LLM by selecting rows with more data
Add configurable selection strategies: 'rich_data', 'diverse', 'random'

Performance improvement: +4.3 average data points per row
```

#### Para Refactoring
```
refactor(data_selector): extract selection strategies to separate module

- Move selection logic from main class to strategy pattern
- Add unit tests for each strategy
- Improve code reusability and testability
```

### Scopes Comunes
- `auth`: Authentication/authorization
- `database`: Database operations
- `api`: API endpoints
- `ui`: User interface
- `config`: Configuration changes
- `docs`: Documentation
- `test`: Testing
- `deploy`: Deployment

---

## 5. Testing y Validaci√≥n

### Estructura de Tests
```
tests/
‚îú‚îÄ‚îÄ unit/           # Tests unitarios r√°pidos
‚îú‚îÄ‚îÄ integration/    # Tests de integraci√≥n
‚îú‚îÄ‚îÄ e2e/           # Tests end-to-end
‚îú‚îÄ‚îÄ fixtures/      # Datos de prueba
‚îî‚îÄ‚îÄ conftest.py    # Configuraci√≥n pytest
```

### Best Practices
```python
# Usar pytest fixtures para setup com√∫n
@pytest.fixture
def sample_data():
    return {"user": "test", "email": "test@example.com"}

# Tests descriptivos
def test_user_creation_should_validate_email_format():
    # Test implementation
    pass

# Mocks para dependencias externas
@patch('requests.get')
def test_api_call_handles_timeout(mock_get):
    mock_get.side_effect = TimeoutError()
    # Test implementation
```

### Comandos √ötiles
```bash
# Python
pytest                    # Ejecutar todos los tests
pytest -v                # Verbose output
pytest --cov=src         # Con coverage
pytest -k "test_user"    # Tests espec√≠ficos
pytest --tb=short        # Traceback corto

# JavaScript
npm test                 # Todos los tests
npm test -- --watch     # Watch mode
npm test -- --coverage  # Con coverage
```

---

## 6. Logging y Observabilidad

### Configuraci√≥n Est√°ndar
```python
import logging
import json
from datetime import datetime

class JSONFormatter(logging.Formatter):
    def format(self, record):
        log_entry = {
            "timestamp": datetime.utcnow().isoformat(),
            "level": record.levelname,
            "component": record.name,
            "message": record.getMessage(),
            "file": record.filename,
            "line": record.lineno
        }
        if record.exc_info:
            log_entry["exception"] = self.formatException(record.exc_info)
        return json.dumps(log_entry)

# Configuraci√≥n
logger = logging.getLogger(__name__)
handler = logging.StreamHandler()
handler.setFormatter(JSONFormatter())
logger.addHandler(handler)
logger.setLevel(logging.INFO)
```

### M√©tricas Clave a Registrar
- ‚è±Ô∏è Tiempo de ejecuci√≥n de funciones cr√≠ticas
- üìä N√∫mero de elementos procesados
- üéØ Tasas de √©xito/error
- üîÑ N√∫mero de reintentos
- üìà Uso de memoria y CPU

---

## 7. Manejo de Errores

### Estrategia de Reintentos
```python
import time
import random
from functools import wraps

def retry_with_backoff(max_retries=3, base_delay=1):
    def decorator(func):
        @wraps(func)
        def wrapper(*args, **kwargs):
            for attempt in range(max_retries):
                try:
                    return func(*args, **kwargs)
                except (RateLimitError, TimeoutError) as e:
                    if attempt == max_retries - 1:
                        raise
                    
                    # Exponential backoff with jitter
                    delay = base_delay * (2 ** attempt) + random.uniform(0, 1)
                    logger.warning(f"Attempt {attempt + 1} failed: {e}. Retrying in {delay:.2f}s")
                    time.sleep(delay)
            
            return wrapper
    return decorator

# Uso
@retry_with_backoff(max_retries=3, base_delay=2)
def call_external_api():
    # API call implementation
    pass
```

### Categor√≠as de Errores
- **üîÑ Retriable**: Rate limits, timeouts, network issues
- **‚ùå Non-retriable**: Authentication, validation, not found
- **‚ö†Ô∏è Critical**: Data corruption, security breaches

---

## 8. Templates Adicionales

### Pull Request Template
Crea `.github/PULL_REQUEST_TEMPLATE.md`:

```markdown
## Descripci√≥n
<!-- Breve descripci√≥n de los cambios -->

## Tipo de cambio
- [ ] Bug fix
- [ ] Nueva feature
- [ ] Refactoring
- [ ] Cambio en documentaci√≥n
- [ ] Breaking change

## Testing
- [ ] Tests unitarios a√±adidos/actualizados
- [ ] Tests de integraci√≥n a√±adidos/actualizados  
- [ ] Todos los tests pasan

## Checklist
- [ ] C√≥digo sigue las convenciones del proyecto
- [ ] Self-review completado
- [ ] Documentaci√≥n actualizada
- [ ] No hay secretos hardcodeados
- [ ] CHANGELOG.md actualizado (si aplica)

## Screenshots (si aplica)
<!-- Capturas de pantalla de cambios UI -->
```

### Issue Template
Crea `.github/ISSUE_TEMPLATE.md`:

```markdown
## Descripci√≥n del problema
<!-- Descripci√≥n clara del issue -->

## Pasos para reproducir
1. 
2. 
3. 

## Comportamiento esperado
<!-- Qu√© deber√≠a pasar -->

## Comportamiento actual
<!-- Qu√© est√° pasando -->

## Entorno
- OS: [Windows/Mac/Linux]
- Versi√≥n: [versi√≥n del software]
- Browser: [si aplica]

## Informaci√≥n adicional
<!-- Logs, screenshots, etc. -->
```

---

## 9. Checklist de Setup de Proyecto

### ‚úÖ Configuraci√≥n Inicial
- [ ] Crear estructura `.github/`
- [ ] Escribir `copilot-instructions.md`
- [ ] Configurar `.gitignore` apropiado
- [ ] Setup de linters y formatters
- [ ] Configurar pre-commit hooks

### ‚úÖ Documentaci√≥n
- [ ] README.md completo
- [ ] CONTRIBUTING.md
- [ ] CHANGELOG.md inicial
- [ ] Templates de PR e Issues

### ‚úÖ CI/CD
- [ ] Workflow de GitHub Actions
- [ ] Tests automatizados
- [ ] Code coverage reporting
- [ ] Security scanning

### ‚úÖ Desarrollo
- [ ] Configuraci√≥n de IDE/VS Code
- [ ] Extensions recomendadas
- [ ] Debugging setup
- [ ] Local development environment

---

## 10. Herramientas Recomendadas

### Python
```bash
# Formatter y linter
pip install black flake8 isort

# Testing
pip install pytest pytest-cov pytest-mock

# Pre-commit hooks
pip install pre-commit
```

### JavaScript/TypeScript
```bash
# Formatter y linter
npm install --save-dev prettier eslint

# Testing  
npm install --save-dev jest @testing-library/jest-dom

# Pre-commit
npm install --save-dev husky lint-staged
```

### VS Code Extensions
- GitHub Copilot
- GitLens
- Python/JavaScript language support
- Prettier formatter
- ESLint/Flake8 linters


